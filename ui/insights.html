<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Insights - Digital Advertising Command</title>
  <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
  <nav class="sidebar">
    <div class="sidebar-header">
      <h1>ğŸ¯ Digital Ad</h1>
      <span class="subtitle">Command Center</span>
    </div>
    <ul class="nav-links">
      <li><a href="/dashboard" class="nav-link">ğŸ“ˆ Dashboard</a></li>
      <li><a href="/campaigns" class="nav-link">ğŸ“‹ Campaigns</a></li>
      <li><a href="/insights" class="nav-link active">ğŸ’¡ Insights</a></li>
      <li><a href="/agents" class="nav-link">ğŸ¤– Agents</a></li>
      <li><a href="/query" class="nav-link">ğŸ’¬ Query</a></li>
      <li><a href="/architecture" class="nav-link">ğŸ—ï¸ Architecture</a></li>
      <li><a href="/connectors" class="nav-link">ğŸ”Œ Connectors</a></li>
    </ul>
  </nav>

  <main class="main-content">
    <header class="page-header">
      <h2>ğŸ’¡ Insights</h2>
      <p>Performance analysis and recommendations</p>
    </header>

    <!-- Run Workflows -->
    <section class="workflow-actions glass">
      <h3>Run Analysis</h3>
      <div class="workflow-buttons">
        <button class="btn btn--primary" onclick="runWorkflow('wow-report')">ğŸ“Š WoW Report</button>
        <button class="btn btn--secondary" onclick="runWorkflow('pacing-check')">â±ï¸ Pacing Check</button>
        <button class="btn btn--secondary" onclick="runWorkflow('optimization')">ğŸ¯ Optimization</button>
        <button class="btn btn--secondary" onclick="runWorkflow('anomaly-detection')">ğŸ” Anomaly Detection</button>
      </div>
    </section>

    <!-- Insights List -->
    <section class="insights-section">
      <h3>Performance Insights</h3>
      <div class="insights-list" id="insights-list">
        <p class="loading">Loading insights...</p>
      </div>
    </section>

    <!-- Workflow Results -->
    <section class="results-section glass" id="workflow-results" style="display: none;">
      <h3 id="results-title">Workflow Results</h3>
      <pre id="results-content"></pre>
    </section>
  </main>

  <script src="assets/app.js"></script>
  <script>
    async function loadInsights() {
      try {
        const insights = await fetch('/api/insights').then(r => r.json());
        
        if (!insights || insights.length === 0) {
          document.getElementById('insights-list').innerHTML = 
            '<p class="empty">No insights available yet</p>';
          return;
        }
        
        document.getElementById('insights-list').innerHTML = insights.map(insight => {
          const icon = insight.type === 'positive' ? 'âœ…' :
                       insight.type === 'concern' ? 'âš ï¸' :
                       insight.type === 'optimization' ? 'ğŸ¯' : 'ğŸ’¡';
          
          return `
            <div class="insight-card glass ${insight.type}">
              <div class="insight-icon">${icon}</div>
              <div class="insight-content">
                <h4>${insight.title}</h4>
                <p>${insight.content}</p>
                ${insight.action ? `<p class="action"><strong>Action:</strong> ${insight.action}</p>` : ''}
              </div>
            </div>
          `;
        }).join('');
        
      } catch (err) {
        console.error('Error loading insights:', err);
        document.getElementById('insights-list').innerHTML = 
          '<p class="error">Error loading insights</p>';
      }
    }
    
    async function runWorkflow(name) {
      const resultsSection = document.getElementById('workflow-results');
      const resultsTitle = document.getElementById('results-title');
      const resultsContent = document.getElementById('results-content');
      
      resultsSection.style.display = 'block';
      resultsTitle.textContent = `Running ${name}...`;
      resultsContent.textContent = 'Please wait...';
      
      try {
        const result = await fetch(`/api/workflows/${name}/run`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' }
        }).then(r => r.json());
        
        resultsTitle.textContent = `${name} Results`;
        resultsContent.textContent = JSON.stringify(result, null, 2);
        
      } catch (err) {
        resultsTitle.textContent = 'Error';
        resultsContent.textContent = err.message;
      }
    }
    
    loadInsights();
  </script>
</body>
</html>
